{% load i18n mezzanine_tags comment_tags rating_tags %}

{% for comment in comments_for_thread %}

<div id="comment-{{ comment.id }}" class="comment media{% if comment.by_author %} comment-author{% endif %}">

    {% editable comment.is_public comment.is_removed %}
    {% if not comment.is_removed and comment.is_public or request.user.is_staff %}

        {# With URLs #}
        {% if comment.url %}
        <div class="avatar">
            <a href="{{ comment.url }}">
                <img src="{% gravatar_url comment.email %}">
            </a>
        </div>
        <div class="comment-right">
            <span class="left-arrow-container-outer">
                <span class="left-arrow-container-inner">
                <i class="left-arrow"></i>
                </span>
            </span>
            <div class="comment-info">
                <span class="comment-username"><a href="{{ comment.url }}">{{ comment.user_name }}</a></span>
        {% else %}
        {# Without URLs #}
        <div class="avatar">
            <img src="{% gravatar_url comment.email %}">
        </div>
        <div class="comment-right">
            <span class="left-arrow-container-outer">
                <span class="left-arrow-container-inner">
                <i class="left-arrow"></i>
                </span>
            </span>

            <div class="comment-info"> 
                <span class="comment-username">{{ comment.user_name }}</span>
        {% endif %}
               <span class="comment-date">{% blocktrans with sometime=comment.submit_date|timesince %}{{ sometime }} ago{% endblocktrans %}</span>
            </div><!--END comment-info-->

            <p>{{ comment.comment|comment_filter }}</p>


            <div class="comment-border">
                {% if not comment.is_removed and comment.is_public %}
                <a class="link" href="{{ request.path }}#comment-{{ comment.id }}">
                    <span class="glyphicon glyphicon-link"></span> {% trans "Link" %}
                </a> |
                <a href="#reply-{{ comment.id }}" class="reply">
                    <span class="glyphicon glyphicon-share-alt"></span> {% trans "Reply" %}
                </a>
                {% endif %}
            </div><!--END comment-border-->
        </div><!-- END comment-right-->

        
   
        {# Ratings #} 
        {# % if settings.COMMENTS_USE_RATINGS % #}
        {# <div class="rating"> #}
            {# {% rating_for comment %} #}
        {# </div>#}
        {# {% endif %} #}

        {# Comment reply form #}
        <form class="comment-reply-form" method="post" id="reply-{{ comment.id }}"
            action="{{ comment_url }}#reply-{{ comment.id }}"
            {% if replied_to != comment.id %}style="display:none;"{% endif %}>
            {% if replied_to == comment.id %}
            {% fields_for posted_comment_form %}
            {% else %}
            {% fields_for unposted_comment_form %}
            {% endif %}
            <input type="hidden" name="replied_to" value="{{ comment.id }}">
            <input class="btn btn-primary btn-lg" type="submit" value="{% trans "Reply" %}">
        </form>


    {# Case where comment has been moved or deleted #}
    {% else %}
    <p>
        {% if comment.is_removed %}
        <span class="glyphicon glyphicon-remove-circle"></span> {% trans "Comment deleted" %}
        {% else %}
        <span class="glyphicon glyphicon-warning-sign"></span> {% trans "Comment awaiting approval" %}
        {% endif %}
        <small class="timespan">{% blocktrans with sometime=comment.submit_date|timesince %}{{ sometime }} ago{% endblocktrans %}</small>
    </p>
    {% endif %}

    {% comment_thread comment %}
    {% endeditable %}
</div>
{% endfor %}

{% if no_comments %}
<p>{% trans "There are currently no comments" %}</p>
{% endif %}

